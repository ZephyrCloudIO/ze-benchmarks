# Zephyr Benchmarks Worker Configuration
# Supports multiple environments: local, dev, staging, production

name = "ze-benchmarks-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Default configuration (local development)
[[ d1_databases ]]
binding = "DB"
database_name = "ze-benchmarks-local"
database_id = "local-db-id" # Local development database
migrations_dir = "drizzle"

[vars]
ENVIRONMENT = "local"
ALLOWED_ORIGINS = "http://localhost:3000,http://localhost:5173"

# Local Environment (explicit)
# Domain: localhost:8787
[env.local]
name = "ze-benchmarks-api-local"

[[env.local.d1_databases]]
binding = "DB"
database_name = "ze-benchmarks-local"
database_id = "local-db-id"
migrations_dir = "drizzle"

[env.local.vars]
ENVIRONMENT = "local"
ALLOWED_ORIGINS = "http://localhost:3000,http://localhost:5173"

# Production Environment
# Domain: bench-api.zephyr-cloud.io
[env.production]
name = "ze-benchmarks-api-prod"
routes = [
  { pattern = "bench-api.zephyr-cloud.io", custom_domain = true }
]

[[env.production.d1_databases]]
binding = "DB"
database_name = "ze-benchmarks-prod"
database_id = "6ed134b1-8502-4c33-9a5a-b831c699f212"
migrations_dir = "drizzle"

[env.production.vars]
ENVIRONMENT = "production"
ALLOWED_ORIGINS = "https://bench.zephyr-cloud.io,https://app.zephyr-cloud.io"

# Staging Environment
# Domain: bench-api-stg.zephyr-cloud.io
[env.staging]
name = "ze-benchmarks-api-stg"
routes = [
  { pattern = "bench-api-stg.zephyr-cloud.io", custom_domain = true }
]

[[env.staging.d1_databases]]
binding = "DB"
database_name = "ze-benchmarks-staging"
database_id = "24393920-d9a3-4260-8bf7-1b97a29db508"
migrations_dir = "drizzle"

[env.staging.vars]
ENVIRONMENT = "staging"
ALLOWED_ORIGINS = "https://bench-stg.zephyr-cloud.io,http://localhost:3000"

# Development Environment (remote testing)
# Domain: bench-api-dev.zephyr-cloud.io
[env.dev]
name = "ze-benchmarks-api-dev"
routes = [
  { pattern = "bench-api-dev.zephyr-cloud.io", custom_domain = true }
]

[[env.dev.d1_databases]]
binding = "DB"
database_name = "ze-benchmarks-dev"
database_id = "4fa3c3a8-42ca-445b-af46-90f04b112516"
migrations_dir = "drizzle"

[env.dev.vars]
ENVIRONMENT = "dev"
ALLOWED_ORIGINS = "https://bench-dev.zephyr-cloud.io,http://localhost:3000"

# For production secrets (use wrangler secret put):
# Production:
#   wrangler secret put API_SECRET_KEY --env production
# Staging:
#   wrangler secret put API_SECRET_KEY --env staging
# Dev:
#   wrangler secret put API_SECRET_KEY --env dev
