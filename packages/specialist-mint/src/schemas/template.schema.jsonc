// JSON5 Schema for Specialist Templates (Pre-minting)
// This schema validates specialist template definitions before they are published/minted
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://zephyr-cloud.dev/schemas/specialist-template.json",
  "title": "Specialist Template Schema",
  "description": "Schema for AI specialist template definitions in the Zephyr Agency system. Templates define specialist capabilities, persona, and prompts before benchmarking.",
  "type": "object",

  // Required fields that must be present in every template
  "required": [
    "schema_version",
    "name",
    "version",
    "persona",
    "capabilities",
    "prompts"
  ],

  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Version of the template schema specification (e.g., '0.0.1')",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },

    "name": {
      "type": "string",
      "description": "Unique identifier for the specialist, typically namespaced (e.g., '@zephyr-cloud/shadcn-specialist')",
      "pattern": "^(@[a-z0-9-]+/)?[a-z0-9-]+$"
    },

    "displayName": {
      "type": "string",
      "description": "Human-readable display name for the specialist (e.g., 'shadcn/ui Expert')"
    },

    "version": {
      "type": "string",
      "description": "Semantic version of this specialist template",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },

    "version_metadata": {
      "type": "object",
      "description": "Version tracking, changelog, and compatibility information",
      "properties": {
        "changelog": {
          "type": "array",
          "description": "Complete version history with changes",
          "items": {
            "type": "object",
            "required": ["version", "date", "type", "changes"],
            "properties": {
              "version": {
                "type": "string",
                "pattern": "^\\d+\\.\\d+\\.\\d+$",
                "description": "Version number"
              },
              "date": {
                "type": "string",
                "format": "date-time",
                "description": "When this version was created"
              },
              "type": {
                "type": "string",
                "enum": ["major", "minor", "patch"],
                "description": "Type of version bump"
              },
              "changes": {
                "type": "array",
                "description": "List of changes in this version",
                "items": {
                  "type": "object",
                  "required": ["category", "description"],
                  "properties": {
                    "category": {
                      "type": "string",
                      "enum": ["enrichment", "prompt", "documentation", "persona", "capabilities", "fix", "other"],
                      "description": "Category of change"
                    },
                    "description": {
                      "type": "string",
                      "description": "Description of the change"
                    },
                    "breaking": {
                      "type": "boolean",
                      "description": "Whether this is a breaking change"
                    },
                    "migration_notes": {
                      "type": "string",
                      "description": "Notes for migrating to this version"
                    }
                  }
                }
              },
              "author": {
                "type": "string",
                "description": "Who made these changes"
              }
            }
          }
        },
        "breaking_changes": {
          "type": "array",
          "description": "Detailed breaking changes history",
          "items": {
            "type": "object",
            "required": ["version", "date", "description", "affected_areas", "migration_guide"],
            "properties": {
              "version": {
                "type": "string",
                "pattern": "^\\d+\\.\\d+\\.\\d+$",
                "description": "Version with breaking change"
              },
              "date": {
                "type": "string",
                "format": "date-time",
                "description": "When the breaking change was introduced"
              },
              "description": {
                "type": "string",
                "description": "Description of the breaking change"
              },
              "affected_areas": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Areas of the template affected"
              },
              "migration_guide": {
                "type": "string",
                "description": "How to migrate from previous version"
              },
              "deprecated_features": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Features that were deprecated"
              }
            }
          }
        },
        "deprecated": {
          "type": "boolean",
          "description": "Whether this template version is deprecated"
        },
        "deprecated_in": {
          "type": "string",
          "description": "Version when this template was deprecated"
        },
        "deprecated_reason": {
          "type": "string",
          "description": "Reason for deprecation"
        },
        "replacement": {
          "type": "string",
          "description": "Recommended replacement template"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "When this template was first created"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "When this template was last updated"
        },
        "last_enriched_at": {
          "type": "string",
          "format": "date-time",
          "description": "When documentation was last enriched"
        },
        "min_schema_version": {
          "type": "string",
          "description": "Minimum schema version required"
        },
        "compatible_with": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Compatible template versions"
        }
      }
    },

    "from": {
      "type": "string",
      "description": "Optional parent template for inheritance. Can be a scoped package reference (e.g., '@zephyr-cloud/base'), relative path (e.g., './base.json5'), or absolute path. See INHERITANCE.md for merge rules."
    },

    "license": {
      "type": "string",
      "description": "Software license for this specialist (e.g., 'MIT', 'Apache-2.0', 'UNLICENSED')"
    },

    "availability": {
      "type": "string",
      "enum": ["public", "private", "paid"],
      "description": "Availability status: 'public' (free), 'private' (internal), or 'paid' (subscription required)"
    },

    "maintainers": {
      "type": "array",
      "description": "List of individuals or teams responsible for maintaining this specialist",
      "items": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Maintainer name or team name"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Contact email for the maintainer"
          }
        }
      }
    },

    "persona": {
      "type": "object",
      "description": "Defines the specialist's identity, expertise, and behavioral characteristics",
      "required": ["purpose", "values", "attributes", "tech_stack"],
      "properties": {
        "purpose": {
          "type": "string",
          "description": "Clear statement of what this specialist does and its primary focus area"
        },

        "values": {
          "type": "array",
          "description": "Core principles and priorities that guide the specialist's behavior (e.g., 'Performance first', 'Developer experience')",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },

        "attributes": {
          "type": "array",
          "description": "Key characteristics and expertise areas of the specialist",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },

        "tech_stack": {
          "type": "array",
          "description": "Technologies, frameworks, and tools the specialist is proficient with",
          "items": {
            "type": "string"
          },
          "minItems": 1
        }
      }
    },

    "capabilities": {
      "type": "object",
      "description": "Defines what the specialist can do and helps with specialist discovery",
      "required": ["tags", "descriptions"],
      "properties": {
        "tags": {
          "type": "array",
          "description": "Searchable tags for capability discovery (e.g., 'shadcn-ui', 'component-theming')",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9-]+$"
          },
          "minItems": 1,
          "uniqueItems": true
        },

        "descriptions": {
          "type": "object",
          "description": "Detailed descriptions for each capability tag. Keys must match tags in the 'tags' array.",
          "patternProperties": {
            "^[a-z0-9-]+$": {
              "type": "string",
              "description": "Description of what this capability enables"
            }
          }
        },

        "considerations": {
          "type": "array",
          "description": "Important notes, limitations, or context about the specialist's capabilities",
          "items": {
            "type": "string"
          }
        }
      }
    },

    "dependencies": {
      "type": "object",
      "description": "External services, tools, and MCPs required or used by this specialist",
      "properties": {
        "subscription": {
          "type": "object",
          "description": "Information about subscription requirements",
          "properties": {
            "required": {
              "type": "boolean",
              "description": "Whether a paid subscription is required to use this specialist"
            },
            "purpose": {
              "type": "string",
              "description": "Explanation of what the subscription provides"
            }
          }
        },

        "available_tools": {
          "type": "array",
          "description": "System tools the specialist requires or uses (e.g., 'file_system', 'terminal', 'git')",
          "items": {
            "type": "string"
          }
        },

        "mcps": {
          "type": "array",
          "description": "Model Context Protocol servers used by this specialist",
          "items": {
            "type": "object",
            "required": ["name", "version"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the MCP server"
              },
              "version": {
                "type": "string",
                "description": "Version constraint (e.g., '^1.0.0')"
              },
              "permissions": {
                "type": "array",
                "description": "Required permissions for this MCP",
                "items": {
                  "type": "string",
                  "enum": ["read", "write", "execute"]
                }
              },
              "description": {
                "type": "string",
                "description": "Purpose of this MCP integration"
              },
              "required": {
                "type": "boolean",
                "description": "Whether this MCP is required or optional"
            },
            "allowed_tools": {
              "type": "array",
              "description": "Optional whitelist of MCP tool names exposed to the agent (e.g., ['figma_get_me', 'figma_get_file'])",
              "items": {
                "type": "string"
              }
              }
            }
          }
        }
      }
    },

    "documentation": {
      "type": "array",
      "description": "Documentation resources for the specialist and its domain",
      "items": {
        "type": "object",
        "required": ["type", "description"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["official", "reference", "recipes", "examples", "control"],
            "description": "Type of documentation resource"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "External URL for web-based documentation"
          },
          "path": {
            "type": "string",
            "description": "Local file path for documentation stored with the specialist"
          },
          "description": {
            "type": "string",
            "description": "Brief description of what this documentation covers"
          },
          "enrichment": {
            "type": "object",
            "description": "LLM-generated enrichment data for intelligent documentation injection",
            "properties": {
              "summary": {
                "type": "string",
                "description": "Comprehensive summary of the documentation content (2-3 paragraphs)"
              },
              "key_concepts": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Key concepts and patterns extracted from the documentation"
              },
              "relevant_for_tasks": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Task types this documentation is relevant for"
              },
              "relevant_tech_stack": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Tech stack items from template that this doc is relevant for"
              },
              "relevant_tags": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Capability tags this documentation is relevant for"
              },
              "code_patterns": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Extracted code patterns and examples"
              },
              "last_enriched": {
                "type": "string",
                "format": "date-time",
                "description": "Timestamp when enrichment was last performed"
              },
              "enrichment_model": {
                "type": "string",
                "description": "LLM model used for enrichment (e.g., 'anthropic/claude-3.5-haiku', 'claude-sonnet-4.5')"
              }
            }
          }
        },
        "oneOf": [
          {"required": ["url"]},
          {"required": ["path"]}
        ]
      }
    },

    "preferred_models": {
      "type": "array",
      "description": "AI models recommended for use with this specialist, with optional performance weights",
      "items": {
        "type": "object",
        "required": ["model"],
        "properties": {
          "model": {
            "type": "string",
            "description": "Model identifier (e.g., 'claude-sonnet-4.5', 'gpt-4o')"
          },
          "specialist_enabled": {
            "type": "boolean",
            "description": "Whether this model should use the specialist (true) or run as baseline/vanilla (false)"
          },
          "weight": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Overall performance weight for this model (0-1)"
          },
          "benchmarks": {
            "type": "object",
            "description": "Per-benchmark performance weights for this model",
            "patternProperties": {
              "^[a-z_]+$": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            }
          }
        }
      }
    },

    "prompts": {
      "type": "object",
      "description": "Prompt templates for different tasks and models, using Mustache interpolation",
      "required": ["default", "prompt_strategy"],
      "properties": {
        "default": {
          "type": "object",
          "description": "Default prompts used when no model-specific prompt is available",
          "properties": {
            "spawnerPrompt": {
              "type": "string",
              "description": "Prompt used when spawning this specialist in a conversation"
            }
          },
          "patternProperties": {
            "^[a-z_]+$": {
              "type": "string",
              "description": "Task-specific prompt template with {mustache} placeholders"
            }
          }
        },

        "model_specific": {
          "type": "object",
          "description": "Prompts tailored for specific AI models",
          "patternProperties": {
            "^[a-z0-9.-]+$": {
              "type": "object",
              "description": "Prompts for a specific model (e.g., 'claude-sonnet-4.5')",
              "properties": {
                "spawnerPrompt": {
                  "type": "string",
                  "description": "Model-specific spawner prompt"
                }
              },
              "patternProperties": {
                "^[a-z_]+$": {
                  "type": "string",
                  "description": "Model-specific task prompt template"
                }
              }
            }
          }
        },

        "prompt_strategy": {
          "type": "object",
          "description": "Configuration for prompt selection and interpolation behavior",
          "properties": {
            "fallback": {
              "type": "string",
              "enum": ["default", "error"],
              "description": "What to do when no model-specific prompt is found: use 'default' or throw 'error'"
            },
            "model_detection": {
              "type": "string",
              "enum": ["auto", "manual"],
              "description": "How to detect which model is being used"
            },
            "allow_override": {
              "type": "boolean",
              "description": "Whether users can override prompts at runtime"
            },
            "interpolation": {
              "type": "object",
              "description": "Template interpolation settings",
              "properties": {
                "style": {
                  "type": "string",
                  "enum": ["mustache", "handlebars"],
                  "description": "Template syntax style"
                },
                "escape_html": {
                  "type": "boolean",
                  "description": "Whether to escape HTML in interpolated values"
                }
              }
            }
          }
        }
      }
    },

    "spawnable_sub-agent_specialists": {
      "type": "array",
      "description": "Sub-specialists that can be spawned by this specialist for specialized subtasks (preferred naming with hyphen)",
      "items": {
        "type": "object",
        "required": ["name", "version", "purpose"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the sub-specialist"
          },
          "version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+$",
            "description": "Version of the sub-specialist"
          },
          "license": {
            "type": "string",
            "description": "License for the sub-specialist"
          },
          "availability": {
            "type": "string",
            "enum": ["public", "private", "paid"],
            "description": "Availability of the sub-specialist"
          },
          "purpose": {
            "type": "string",
            "description": "What specialized task this sub-specialist handles"
          }
        }
      }
    },

    "spawnable_sub_agent_specialists": {
      "type": "array",
      "description": "Sub-specialists that can be spawned by this specialist for specialized subtasks (alternative naming with underscores for backward compatibility)",
      "items": {
        "type": "object",
        "required": ["name", "version", "purpose"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the sub-specialist"
          },
          "version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+$",
            "description": "Version of the sub-specialist"
          },
          "license": {
            "type": "string",
            "description": "License for the sub-specialist"
          },
          "availability": {
            "type": "string",
            "enum": ["public", "private", "paid"],
            "description": "Availability of the sub-specialist"
          },
          "purpose": {
            "type": "string",
            "description": "What specialized task this sub-specialist handles"
          }
        }
      }
    },

    "benchmarks": {
      "type": "object",
      "description": "Benchmark configuration for validating and measuring specialist performance",
      "properties": {
        "test_suites": {
          "type": "array",
          "description": "List of benchmark test suites for this specialist",
          "items": {
            "type": "object",
            "required": ["name", "path", "type", "description"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Unique identifier for the test suite"
              },
              "path": {
                "type": "string",
                "description": "Path to the benchmark suite directory or file"
              },
              "type": {
                "type": "string",
                "enum": ["functional", "accuracy", "performance", "integration"],
                "description": "Type of benchmark test"
              },
              "description": {
                "type": "string",
                "description": "What this benchmark tests"
              }
            }
          }
        },
        "scoring": {
          "type": "object",
          "description": "Scoring methodology and comparison configuration",
          "properties": {
            "methodology": {
              "type": "string",
              "enum": ["weighted_average", "pass_fail", "percentile", "custom"],
              "description": "How scores are calculated across benchmarks"
            },
            "update_frequency": {
              "type": "string",
              "enum": ["per_run", "per_experiment", "daily", "weekly", "manual"],
              "description": "How often benchmark results should be refreshed"
            },
            "comparison_targets": {
              "type": "array",
              "description": "What to compare specialist performance against (e.g., 'control', 'generic', 'baseline')",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  },

  "additionalProperties": false
}
