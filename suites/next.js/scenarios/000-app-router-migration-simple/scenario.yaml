id: ZE_nextjs_app_router_migration_simple
suite: next.js
title: "Pages Router to App Router Migration"
description: |
  This evaluation tests the ability to migrate a Next.js project from the legacy Pages Router (Next.js 12 and earlier) to the modern App Router (Next.js 13+). This is a fundamental architectural change that many real-world Next.js projects need to undergo.

workspace:
  node: "20.x"
  manager: auto
  managers_allowed: [pnpm]
  workspaces: pnpm

baseline:
  run:
    - cmd: "pnpm install"
    - cmd: "pnpm build"
    - cmd: "pnpm lint"
    - cmd: "pnpm test"

validation:
  commands:
    install: "pnpm install"
    test: "pnpm test"
    lint: "pnpm lint"

oracle:
  answers_file: "./oracle-answers.json"

heuristic_checks:
  enabled: true

  # Critical validation commands
  commands:
    - name: "install_succeeds"
      command: "pnpm install"
      weight: 2.0
      description: "Dependencies install successfully"

    - name: "build_succeeds"
      command: "pnpm build"
      weight: 3.0
      description: "Production build completes without errors"

    - name: "tests_pass"
      command: "pnpm test"
      weight: 2.0
      description: "Test suite passes"

    - name: "lint_passes"
      command: "pnpm lint"
      weight: 1.0
      description: "Code meets linting standards"

  # Verify App Router structure
  files:
    - name: "app_directory_exists"
      path: "app"
      weight: 2.0
      description: "App Router directory exists"

    - name: "next_config_exists"
      path: "next.config.js"
      weight: 0.5
      description: "Next.js configuration file exists"

  # Check for App Router patterns
  patterns:
    - name: "has_page_files"
      file: "app/**/*.tsx"
      pattern: "export default|export async function"
      weight: 2.0
      description: "App Router page components exist"

    - name: "has_layout_file"
      file: "app/**/layout.tsx"
      pattern: "export default.*RootLayout|export default function.*Layout"
      weight: 1.5
      description: "Layout component exists in App Router"

    - name: "uses_metadata_api"
      file: "app/**/*.tsx"
      pattern: "export const metadata|export async function generateMetadata"
      weight: 1.0
      description: "Uses App Router metadata API"

    - name: "no_pages_router_patterns"
      file: "app/**/*.tsx"
      pattern: "getServerSideProps|getStaticProps|getInitialProps"
      weight: 1.5
      description: "No legacy Pages Router data fetching patterns"

llm_judge:
  enabled: true
  model: "anthropic/claude-3.5-sonnet"
  temperature: 0.1
  max_tokens: 2000
  categories:
    - "Migration Correctness (Weight: 30%): Accurate conversion from Pages Router to App Router structure, proper file organization (page.tsx, layout.tsx). Score 1-5: 1=incorrect structure, 5=perfect migration"
    - "Data Fetching Conversion (Weight: 25%): Proper transformation of getServerSideProps/getStaticProps to Server Components or server actions. Score 1-5: 1=broken data fetching, 5=optimal patterns"
    - "Routing & API Migration (Weight: 20%): Correct migration of dynamic routes, API routes to route handlers. Score 1-5: 1=routing broken, 5=seamless routing"
    - "Code Quality & Best Practices (Weight: 15%): Clean code, proper use of 'use client' directives, App Router conventions. Score 1-5: 1=poor quality, 5=exemplary"
    - "Overall Migration Success (Weight: 10%): Completeness, functionality preservation, no regressions. Score 1-5: 1=non-functional, 5=flawless migration"
